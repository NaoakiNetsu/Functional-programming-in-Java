# 双方向データバインディング

## 双方向データバインディングって何？

AngularJS<sup>[※1](#ref1)</sup> （以降はAngular）が持つ特徴的な機能の1つで、Javascript のオブジェクト（Model）が保持するデータと、HTML テンプレート（View）として画面に表示される内容を自動的に連携する機能です。

簡単に言えば、「画面での入力はJavascript 上の変数に自動的に反映される」、さらに「Javascript 上の変数が変化すると自動的に画面に反映される」といった動きをするので『**双方向**』と呼ばれているわけです。。

<a name="ref1"></a>※1 AngularJS で双方向データバインディングを実現するために最も重要なScope オブジェクトですが、**Angular2 以降は廃止**されています。そもそも、Anguar2 では原則単方向バインディングを利用することになっています（双方向も使えないことはないが）。

## 従来の場合

従来はJavascript のコードから直接DOMを操作し値の書き換えを行ったり、DOM 要素に対するイベントのハンドルが必要でした。  
注）ここで、DOM は何か？といった部分を説明すると主旨からだいぶ外れてしまうので割愛します。

イベントのハンドリングやDOM操作を素のJavascriptのみで実装するのは大きな労力が必要なため、「**JQuery**」のようなライブラリを用いるのが一般的です。

例えば、はじめは'Hello, World!'とテキストが表示され、「push」ボタンをクリックすると'Goodbye, Everyone!'に変化するようなプログラムをJQueryを用いて実装してみます。（body要素の記述などは省きます。）

```HTML
HTML:
<div>
 <p id="message"></p>
 <button id="goodbye">push</button>
</div>
```

```javascript
javascript：

$(function() {
    $('#message').text('Hello, World!');
    $('#goodbye').click(function() {
        $('#message').text('Goodbye, Everyone!');
    })
});
```

イベントを受けて、色々と処理を実行できるので、とても便利です。

しかしながら、HTMLに都度IDを振って、監視するための処理を記述してとなるととても手間で、複雑で大きな画面になるほど、その影響は大きくなります。

## Angular の場合

天下り的になってしまいますが、とりあえず上のプログラムをAngularを用いて実装してみると以下のようになります。

```HTML
HTML:
<div ng-controller="NormalController">
    <p>{{message}}></p>
    <button ng-click="goodbye()">push</button>
</div>
```

```javascript
javascript：

angular.module('app', []).controller('NormalController',['$scope', function($scope) { // ここら辺は定型句みたいなものです
    $scope.message = 'Hello, World!';
    $scope.goodbye = function () {
        $scope.message = 'Gppdbye, Everyone!';
    }
}]);
```

message は表示される文言の変数で、コントローラ側での変更がテンプレート側に即座に反映されます。またテンプレートのbutton要素に対してng-clickディレクティブ（ディレクティブについては別でまとめます）を用いて、クリックイベントを受けて呼び出される関数を記述しています。

テンプレート側にid を振ることもなく、コントローラ側では変数と関数の定義のみを行い、**イベントを監視するような記述、DOMを直接操作するような記述は一切ありません**。

この程度のDOM操作であればほとんど差がないように感じるかもしれませんが、より多くのイベントを監視して、処理を記述していくことを考えれば、Angularのインパクトの大きさは想像に難くないと思います。

※今回の例では、ng-controller を使ってテンプレートにコントローラの割り当てを行っていますが、通常?一般的に？よく見るの？はui-router を用いてルーティングの設定の一部としてコントローラの指定を行います。（その場合、テンプレート側ではng-controller を用いてコントローラの指定は行いません。）

## Scope オブジェクトとは？

前節で『イベントを監視するような記述、DOMを直接操作するような記述は一切ありません』と言いましたが、ではいったいどのようにして双方向データバインディングを実現しているのでしょうか？

ここで鍵となってくるのが「**Scope**」と呼ばれるオブジェクトです。

Scope とはHTML テンプレート（View）とコントローラ（ないし、Model）<sup>[※2](#ref2)</sup>の橋渡しをし、**テンプレートに対して公開するデータや、テンプレートで発生したイベントに対するアクションを保持するオブジェクト**です。

Scope が保持するプロパティは**内容の変更がAngular によって監視されており**、プロパティの値が変化すると、その変更内容がDOM ないしはコントローラの変数に反映されます。また、DOM　イベントが発生した場合は、Scope で保持している関数が呼び出されます。

ここまでの説明を前節のプログラムに当てはめて考えてみる。


<a name="ref2"></a>※2 MVCモデルにおけるコントローラは、あくまでDOM操作に対する処理を記述するもので、ビジネスロジックに相当する処理はModel で作成されるべきであり、それはAngularにおけるコントローラモジュールにおいても同様である。
## 実現方法
